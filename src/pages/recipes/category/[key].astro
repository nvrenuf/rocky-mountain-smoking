---
import Layout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import RecipeCard from '../../../components/RecipeCard.astro';
import { BBQ_CATEGORIES } from '../../../data/bbqCategories';

export async function getStaticPaths() {
  const recipes = await getCollection('recipes');
  const published = recipes.filter((recipe) => !recipe.data.draft);

  return BBQ_CATEGORIES.map((category) => {
    const categoryRecipes = published
      .filter((recipe) => recipe.data.category === category.key)
      .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
    return {
      params: { key: category.key },
      props: { category, categoryRecipes },
      route: `/recipes/category/${category.key}/`,
    };
  });
}

const { category, categoryRecipes } = Astro.props;
---

<Layout title={`${category.label} Recipes Â· Rocky Mountain Smoking`} description={category.description}>
  <main class="bg-[var(--color-page)] py-14 text-[var(--color-text)] sm:py-16">
    <div class="mx-auto max-w-screen-xl space-y-6 px-4 sm:px-6 lg:px-8">
      <div class="space-y-3">
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-[var(--color-muted)]">Recipe category</p>
        <h1 class="text-3xl font-semibold text-[var(--color-text)] sm:text-4xl">{category.label}</h1>
        {category.description && <p class="max-w-3xl text-[var(--color-muted)]">{category.description}</p>}
      </div>

      {categoryRecipes.length > 0 ? (
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {categoryRecipes.map((recipe) => (
            <RecipeCard recipe={recipe} />
          ))}
        </div>
      ) : (
        <div class="rounded-2xl border border-neutral-200 bg-neutral-50 p-6 text-neutral-700">
          No recipes in this category yet. Check back soon.
        </div>
      )}
    </div>
  </main>
</Layout>
